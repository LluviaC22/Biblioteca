{"ast":null,"code":"// generarPdfReserva.js\nimport PDFDocument from 'pdfkit';\nimport fs from 'fs';\nimport fsPromises from 'fs/promises';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nexport const generarPdfReserva = async (req, res) => {\n  try {\n    const {\n      id_usuario,\n      id_libro,\n      fecha_reserva,\n      fecha_devolucion,\n      generar_pdf\n    } = req.body;\n    if (!generar_pdf) {\n      return res.json({\n        message: 'Reserva realizada sin generar PDF'\n      });\n    }\n    const pdfDir = path.join(__dirname, '..', 'Pdfkit');\n    try {\n      await fsPromises.access(pdfDir);\n    } catch {\n      await fsPromises.mkdir(pdfDir, {\n        recursive: true\n      });\n    }\n    const filePath = path.join(pdfDir, `GenerarPdf_${id_usuario}.pdf`);\n    const doc = new PDFDocument();\n    const writeStream = fs.createWriteStream(filePath);\n    doc.pipe(writeStream);\n    doc.fontSize(18).text('Ficha de Reserva/Préstamo', {\n      align: 'center'\n    });\n    doc.moveDown();\n    doc.fontSize(14).text(`ID Usuario: ${id_usuario}`);\n    doc.text(`ID Libro: ${id_libro}`);\n    doc.text(`Fecha de Reserva: ${fecha_reserva}`);\n    doc.text(`Fecha de Devolución: ${fecha_devolucion}`);\n    doc.end();\n    await new Promise(resolve => writeStream.on('finish', resolve));\n    res.download(filePath, `reserva_${id_usuario}.pdf`, async err => {\n      if (err) {\n        console.error('Error al enviar el archivo:', err);\n        res.status(500).json({\n          message: 'Error al enviar el archivo'\n        });\n      } else {\n        try {\n          await fsPromises.unlink(filePath);\n        } catch (unlinkError) {\n          console.error('Error al eliminar el archivo:', unlinkError);\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Error general:', error);\n    res.status(500).json({\n      message: 'Error al generar el PDF'\n    });\n  }\n};","map":{"version":3,"names":["PDFDocument","fs","fsPromises","path","fileURLToPath","__filename","import","meta","url","__dirname","dirname","generarPdfReserva","req","res","id_usuario","id_libro","fecha_reserva","fecha_devolucion","generar_pdf","body","json","message","pdfDir","join","access","mkdir","recursive","filePath","doc","writeStream","createWriteStream","pipe","fontSize","text","align","moveDown","end","Promise","resolve","on","download","err","console","error","status","unlink","unlinkError"],"sources":["C:/Biblioteca Pública/my-react/src/components/FormularioReserva.js"],"sourcesContent":["// generarPdfReserva.js\r\nimport PDFDocument from 'pdfkit';\r\nimport fs from 'fs';\r\nimport fsPromises from 'fs/promises';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nexport const generarPdfReserva = async (req, res) => {\r\n  try {\r\n    const { id_usuario, id_libro, fecha_reserva, fecha_devolucion, generar_pdf } = req.body;\r\n\r\n    if (!generar_pdf) {\r\n      return res.json({ message: 'Reserva realizada sin generar PDF' });\r\n    }\r\n\r\n    const pdfDir = path.join(__dirname, '..', 'Pdfkit');\r\n    try {\r\n      await fsPromises.access(pdfDir);\r\n    } catch {\r\n      await fsPromises.mkdir(pdfDir, { recursive: true });\r\n    }\r\n\r\n    const filePath = path.join(pdfDir, `GenerarPdf_${id_usuario}.pdf`);\r\n\r\n    const doc = new PDFDocument();\r\n    const writeStream = fs.createWriteStream(filePath);\r\n    doc.pipe(writeStream);\r\n\r\n    doc.fontSize(18).text('Ficha de Reserva/Préstamo', { align: 'center' });\r\n    doc.moveDown();\r\n    doc.fontSize(14).text(`ID Usuario: ${id_usuario}`);\r\n    doc.text(`ID Libro: ${id_libro}`);\r\n    doc.text(`Fecha de Reserva: ${fecha_reserva}`);\r\n    doc.text(`Fecha de Devolución: ${fecha_devolucion}`);\r\n\r\n    doc.end();\r\n\r\n    await new Promise((resolve) => writeStream.on('finish', resolve));\r\n\r\n    res.download(filePath, `reserva_${id_usuario}.pdf`, async (err) => {\r\n      if (err) {\r\n        console.error('Error al enviar el archivo:', err);\r\n        res.status(500).json({ message: 'Error al enviar el archivo' });\r\n      } else {\r\n        try {\r\n          await fsPromises.unlink(filePath);\r\n        } catch (unlinkError) {\r\n          console.error('Error al eliminar el archivo:', unlinkError);\r\n        }\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('Error general:', error);\r\n    res.status(500).json({ message: 'Error al generar el PDF' });\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}