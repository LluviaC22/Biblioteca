{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{useParams,useNavigate}from'react-router-dom';import{Modal,Button}from'react-bootstrap';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RestablecerContrasena=()=>{const{token}=useParams();const navigate=useNavigate();const[isTokenValid,setIsTokenValid]=useState(false);const[nuevaContrasena,setNuevaContrasena]=useState('');const[confirmarContrasena,setConfirmarContrasena]=useState('');const[modalMessage,setModalMessage]=useState('');const[modalVisible,setModalVisible]=useState(false);const[isSuccess,setIsSuccess]=useState(false);// Verificar el token al cargar el componente\nuseEffect(()=>{const verificarToken=async()=>{try{const response=await axios.get(`http://localhost:8000/usuarios/restablecer-contrasena/${token}`);if(response.data.isValid){setIsTokenValid(true);}}catch(error){setModalMessage('El token no es válido o ha expirado');setModalVisible(true);}};verificarToken();},[token]);// Manejar el envío del formulario\nconst handleSubmit=async e=>{e.preventDefault();if(nuevaContrasena!==confirmarContrasena){setModalMessage('Las contraseñas no coinciden');setModalVisible(true);return;}try{const response=await axios.put(`http://localhost:8000/usuarios/restablecer/${token}`,{nuevaContrasena});setModalMessage(response.data.message);setIsSuccess(true);setModalVisible(true);}catch(error){var _error$response,_error$response$data;setModalMessage(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Error al actualizar la contraseña');setModalVisible(true);}};// Función para cerrar el modal\nconst closeModal=()=>{setModalVisible(false);if(isSuccess){navigate('/login');// Redirige al login después del éxito\n}};// Si el token no es válido, mostrar un mensaje\nif(!isTokenValid&&!modalVisible){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center mt-10 text-danger\",children:\"Verificando token...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-5\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Restablecer Contrase\\xF1a\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Ingresa tu nueva contrase\\xF1a y conf\\xEDrmala para poder restablecer tu acceso. Aseg\\xFArate de que ambas contrase\\xF1as coincidan.\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"nuevaContrasena\",className:\"form-label\",children:\"Nueva Contrase\\xF1a\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"nuevaContrasena\",value:nuevaContrasena,onChange:e=>setNuevaContrasena(e.target.value),className:\"form-control\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"confirmarContrasena\",className:\"form-label\",children:\"Confirmar Contrase\\xF1a\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"confirmarContrasena\",value:confirmarContrasena,onChange:e=>setConfirmarContrasena(e.target.value),className:\"form-control\",required:true})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"Restablecer Contrase\\xF1a\"})]}),/*#__PURE__*/_jsxs(Modal,{show:modalVisible,onHide:closeModal,centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:isSuccess?'Éxito':'Error'})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(\"p\",{children:modalMessage})}),/*#__PURE__*/_jsx(Modal.Footer,{children:/*#__PURE__*/_jsx(Button,{variant:isSuccess?'success':'danger',onClick:closeModal,children:isSuccess?'Ir al Login':'Cerrar'})})]})]});};export default RestablecerContrasena;","map":{"version":3,"names":["React","useState","useEffect","axios","useParams","useNavigate","Modal","Button","jsx","_jsx","jsxs","_jsxs","RestablecerContrasena","token","navigate","isTokenValid","setIsTokenValid","nuevaContrasena","setNuevaContrasena","confirmarContrasena","setConfirmarContrasena","modalMessage","setModalMessage","modalVisible","setModalVisible","isSuccess","setIsSuccess","verificarToken","response","get","data","isValid","error","handleSubmit","e","preventDefault","put","message","_error$response","_error$response$data","closeModal","className","children","onSubmit","htmlFor","type","id","value","onChange","target","required","show","onHide","centered","Header","closeButton","Title","Body","Footer","variant","onClick"],"sources":["C:/BibliotecaPublica/my-react/src/components/RestablecerContrasena.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { Modal, Button } from 'react-bootstrap';\r\n\r\nconst RestablecerContrasena = () => {\r\n  const { token } = useParams();\r\n  const navigate = useNavigate();\r\n  const [isTokenValid, setIsTokenValid] = useState(false);\r\n  const [nuevaContrasena, setNuevaContrasena] = useState('');\r\n  const [confirmarContrasena, setConfirmarContrasena] = useState('');\r\n  const [modalMessage, setModalMessage] = useState('');\r\n  const [modalVisible, setModalVisible] = useState(false);\r\n  const [isSuccess, setIsSuccess] = useState(false);\r\n\r\n  // Verificar el token al cargar el componente\r\n  useEffect(() => {\r\n    const verificarToken = async () => {\r\n      try {\r\n        const response = await axios.get(`http://localhost:8000/usuarios/restablecer-contrasena/${token}`);\r\n        if (response.data.isValid) {\r\n          setIsTokenValid(true);\r\n        }\r\n      } catch (error) {\r\n        setModalMessage('El token no es válido o ha expirado');\r\n        setModalVisible(true);\r\n      }\r\n    };\r\n\r\n    verificarToken();\r\n  }, [token]);\r\n\r\n  // Manejar el envío del formulario\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (nuevaContrasena !== confirmarContrasena) {\r\n      setModalMessage('Las contraseñas no coinciden');\r\n      setModalVisible(true);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await axios.put(\r\n        `http://localhost:8000/usuarios/restablecer/${token}`,\r\n        { nuevaContrasena }\r\n      );\r\n      setModalMessage(response.data.message);\r\n      setIsSuccess(true);\r\n      setModalVisible(true);\r\n    } catch (error) {\r\n      setModalMessage(error.response?.data?.message || 'Error al actualizar la contraseña');\r\n      setModalVisible(true);\r\n    }\r\n  };\r\n\r\n  // Función para cerrar el modal\r\n  const closeModal = () => {\r\n    setModalVisible(false);\r\n    if (isSuccess) {\r\n      navigate('/login'); // Redirige al login después del éxito\r\n    }\r\n  };\r\n\r\n  // Si el token no es válido, mostrar un mensaje\r\n  if (!isTokenValid && !modalVisible) {\r\n    return <div className=\"text-center mt-10 text-danger\">Verificando token...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mt-5\">\r\n      <h2>Restablecer Contraseña</h2>\r\n      <p>\r\n        Ingresa tu nueva contraseña y confírmala para poder restablecer tu acceso. Asegúrate de que ambas contraseñas coincidan.\r\n      </p>\r\n      <form onSubmit={handleSubmit}>\r\n        <div className=\"mb-3\">\r\n          <label htmlFor=\"nuevaContrasena\" className=\"form-label\">Nueva Contraseña</label>\r\n          <input\r\n            type=\"password\"\r\n            id=\"nuevaContrasena\"\r\n            value={nuevaContrasena}\r\n            onChange={(e) => setNuevaContrasena(e.target.value)}\r\n            className=\"form-control\"\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"mb-3\">\r\n          <label htmlFor=\"confirmarContrasena\" className=\"form-label\">Confirmar Contraseña</label>\r\n          <input\r\n            type=\"password\"\r\n            id=\"confirmarContrasena\"\r\n            value={confirmarContrasena}\r\n            onChange={(e) => setConfirmarContrasena(e.target.value)}\r\n            className=\"form-control\"\r\n            required\r\n          />\r\n        </div>\r\n        <button type=\"submit\" className=\"btn btn-primary\">Restablecer Contraseña</button>\r\n      </form>\r\n\r\n      {/* Modal de React-Bootstrap */}\r\n      <Modal show={modalVisible} onHide={closeModal} centered>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>{isSuccess ? 'Éxito' : 'Error'}</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <p>{modalMessage}</p>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant={isSuccess ? 'success' : 'danger'} onClick={closeModal}>\r\n            {isSuccess ? 'Ir al Login' : 'Cerrar'}\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RestablecerContrasena;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}